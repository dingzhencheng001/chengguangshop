<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>会员列表</title>
    <script src="plugins/jquery/jquery-3.2.0.min.js"></script>
    <!-- layui -->
    <!--        <link rel="stylesheet" href="plugins/layui/css/layui.css" media="all"/>-->
    <!--        <script src="plugins/layui/layui.js"></script>-->
    <!--    <link rel="stylesheet" href="plugins/layui-v2.4.0/css/layui.css" media="all" />-->
    <!--    <script src="plugins/layui-v2.4.0/layui.js"></script>-->
    <link rel="stylesheet" href="plugins/layui-v2.7.5/css/layui.css" media="all"/>
    <script src="plugins/layui-v2.7.5/layui.js"></script>

    <!-- 图标库 -->
    <link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css" media="all"/>
    <!-- ztree -->
    <link rel="stylesheet" href="plugins/ztree/css/metroStyle/metroStyle.css"/>
    <script src="plugins/ztree/js/jquery.ztree.all.js"></script>
    <!-- 下拉列表 -->
    <script src="js/common/combobox.js"></script>
    <script src="js/common/inputTree.js"></script>
    <!-- 全局属性 -->
    <script src="js/common/setting.js"></script>
    <script src="js/common/app.js"></script>
    <script src="lang/index.js"></script>
    <!-- css -->
    <link rel="stylesheet" href="css/app.css"/>
    <!-- 加载formSelects -->
    <link rel="stylesheet" href="plugins/formSelects/formSelects-v4.css"/>
    <script src="plugins/formSelects/formSelects-v4.js"></script>
    <link rel="stylesheet" href="css/console.css">
</head>

<body>
<div class="layui-fluid member-list-page">

    <div class="think-box-shadow">
        <fieldset>
            <legend data-locale="conditionalSearch">条件搜索</legend>
            <form class="layui-form layui-form-pane form-search" lay-filter="searchForm" action="">
                <div class="layui-form-item layui-inline">
                    <label class="layui-form-label" data-locale="keyword">关键词</label>
                    <div class="layui-input-inline">
                        <input name="keyword" value="" data-placeholder="member.petKeyword" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item layui-inline">
                    <label class="layui-form-label" data-locale="member.registrationTime">注册时间</label>
                    <div class="layui-input-inline">
                        <input type="text" name="time" class="layui-input" id="registrationTime"
                               data-placeholder="member.petRegistrationTime">
                    </div>
                </div>
                <div class="layui-form-item layui-inline">
                    <label class="layui-form-label" data-locale="member.status">状态</label>
                    <div class="layui-input-inline">
                        <select name="memberStatus">
                            <option value="">所有状态</option>
                            <option value="1" data-locale="member.status1">真人</option>
                            <option value="2" data-locale="member.status2">假人</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item layui-inline">
                    <button type="submit" class="layui-btn layui-btn-danger" lay-submit lay-filter="search"
                            data-locale="search"><i
                            class="layui-icon"></i> 搜 索
                    </button>
                </div>
            </form>
        </fieldset>

    </div>

    <div class="layui-btn-container" style="margin-top: 20px;">
        <button class="layui-btn" id="createBtn" data-locale="member.addMember">添加会员</button>
    </div>

    <table id="member-list" lay-filter="member-list" style="margin-top: 5px"></table>

    <!--修改邀请码表单-->
    <div id="upInviteCodeId" style="display: none">
        <form class="layui-form layui-card" action="">
            <div class="layui-card-body">
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.invitationCode">邀请码</label>
                    <div class="layui-input-block">
                        <input type="text" name="inviteCode" required id="newInviteCode" lay-verify="required"
                               data-placeholder="member.petInvitationCode" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="layui-form-item text-center" style="text-align: center;">
                    <button class="layui-btn" lay-submit lay-filter="upInviteCodeSubmit" data-locale="submit">提交</button>
                    <button type="reset" class="layui-btn layui-btn-danger" id="dupInviteCodeCancel" data-locale="cancel">取消</button>
                </div>
            </div>
        </form>
    </div>

    <!--扣款表单-->
    <div id="deductionId" style="display: none">
        <form class="layui-form layui-card" lay-filter="deductionForm">
            <div class="layui-card-body">
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.operaMount">金额</label>
                    <div class="layui-input-block">
                        <input type="number" name="operaMount" lay-verify="number" data-placeholder="member.petOperaMount"
                               autocomplete="off"
                               class="layui-input">
                        <p class="help-block" data-locale="member.operaMountHelp">正表示加，负表示扣</p>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" data-locale="member.remarks">备注</label>
                    <div class="layui-input-block">
                        <input type="text" name="remank" data-placeholder="member.petRemarks" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="layui-form-item text-center" style="text-align: center;">
                    <button class="layui-btn" lay-submit lay-filter="deductionSubmit" data-locale="submit">提交</button>
                    <button type="reset" class="layui-btn layui-btn-danger" id="deductionCancel" data-locale="cancel">取消</button>
                </div>
            </div>
        </form>
    </div>

    <!--编辑菜单-->
    <div id="editId" style="display: none">
        <form class="layui-form layui-card" lay-filter="editForm">
            <div class="layui-card-body">
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.userName">用户名称</label>
                    <div class="layui-input-block">
                        <input name="userAccount" lay-verify="required" data-placeholder="member.petUserName" value="" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.phoneNumber">手机号码</label>
                    <div class="layui-input-block">
                        <input name="phoneNumber" lay-verify="phone" data-placeholder="member.petPhoneNumber" value="" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" data-locale="member.balance">账号余额</label>
                    <div class="layui-input-block">
                        <input name="balance" type="number" min="0" data-placeholder="member.petBalance" lay-verify="number" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" data-locale="member.freezeBalance">冻结金额</label>
                    <div class="layui-input-block">
                        <input name="freezeBalance" type="number" min="0" data-placeholder="member.petFreezeBalance" value="" class="layui-input" disabled>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required" data-locale="member.limitAmount">设定金额</label>
                    <div class="layui-input-block">
                        <input name="limitAmount" type="number" lay-verify="limitAmount" min="100"
                               data-placeholder="member.petLimitAmount" value="" class="layui-input"/>
                    </div>
                </div>
                <!--                <div class="layui-form-item">-->
                <!--                    <div class="layui-inline">-->
                <!--                        <label class="layui-form-label label-required">匹配区间</label>-->
                <!--                        <div class="layui-input-inline"-->
                <!--                             style="width: 100px;display:flex;flex-direction: row;align-items: center;">-->
                <!--                            <input type="text" name="match_min" placeholder="最小" value="0" autocomplete="off"-->
                <!--                                   class="layui-input"/>-->
                <!--                            <span> %</span>-->
                <!--                        </div>-->
                <!--                        <div class="layui-form-mid">-</div>-->
                <!--                        <div class="layui-input-inline"-->
                <!--                             style="width: 100px;display:flex;flex-direction: row;align-items: center;">-->
                <!--                            <input-->
                <!--                                    type="text" name="match_max" placeholder="最大" value="0" autocomplete="off"-->
                <!--                                    class="layui-input"/>-->
                <!--                            <span> %</span>-->
                <!--                        </div>-->
                <!--                    </div>-->
                <!--                </div>-->
                <div class="layui-form-item">
                    <label class="layui-form-label label-required" data-locale="member.memberLevel">会员等级</label>
                    <div class="layui-input-block">
                        <select id="memberLevelSelect" name="memberLevelId" lay-verify="required"></select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" data-locale="member.password">登录密码</label>
                    <div class="layui-input-block">
                        <input name="password" data-placeholder="member.petPassword" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" data-locale="member.parentUserId">上级ID</label>
                    <div class="layui-input-block">
                        <input name="parentUserId" data-placeholder="member.petParentUserId" value="0" class="layui-input"/>
                    </div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="layui-form-item text-center" style="text-align: center;">
                    <button class="layui-btn" lay-submit lay-filter="editSubmit" data-locale="submit">提交</button>
                    <button type="reset" class="layui-btn layui-btn-danger" id="editCancel" data-locale="cancel">取消</button>
                </div>
            </div>
        </form>
    </div>

    <!--地址信息-->
    <div id="addressInfoId" style="display: none">
        <form class="layui-form layui-card" lay-filter="addressInfoForm" autocomplete="off">
            <div class="layui-card-body">
                <div class="layui-form-item">
                    <label class="layui-form-label" data-locale="member.address.name">收货姓名</label>
                    <div class="layui-input-block">
                        <input name="name" data-placeholder="member.address.petName" value="" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.address.tel">收货手机</label>
                    <div class="layui-input-block">
                        <input name="tel" lay-verify="phone" value="" data-placeholder="member.address.petTel" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.address.address">详细地址</label>
                    <div class="layui-input-block">
                        <input name="address" lay-verify="required" value="" data-placeholder="member.address.petAddress" class="layui-input"/>
                    </div>
                </div>
            </div>
            <div class="hr-line-dashed"></div>
            <div class="layui-form-item text-center" style="text-align: center;">
                <button class="layui-btn" lay-submit lay-filter="addressInfoSubmit" data-locale="submit">提交</button>
                <button type="reset" class="layui-btn layui-btn-danger" id="addressInfoCancel" data-locale="cancel">取消</button>
            </div>
        </form>
    </div>

    <!--    创建会员-->
    <div id="createId" style="display: none">
        <form class="layui-form layui-card" lay-filter="createForm">
            <div class="layui-card-body">
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.userName">用户名称</label>
                    <div class="layui-input-block">
                        <input name="userAccount" data-placeholder="member.petUserName" lay-verify="required" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.phoneNumber">手机号码</label>
                    <div class="layui-input-block">
                        <input name="phoneNumber" lay-verify="phone" data-placeholder="member.petPhoneNumber" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.password">登录密码</label>
                    <div class="layui-input-block">
                        <input name="password" lay-verify="required" data-placeholder="member.petPassword2" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" data-locale="member.parentUserId">上级ID</label>
                    <div class="layui-input-block">
                        <input name="parentUserId" data-placeholder="member.petParentUserId" class="layui-input"/>
                    </div>
                </div>
            </div>
            <div class="hr-line-dashed"></div>
            <div class="layui-form-item text-center">
                <button class="layui-btn" type="button" lay-submit lay-filter="createSubmit" data-locale="submit">提交</button>
                <button class="layui-btn layui-btn-danger" type="button" id="createCancel" data-locale="cancel">取消</button>
            </div>
        </form>
    </div>

    <!--    发送消息-->
    <div id="sendMessageId" style="display: none">
        <form class="layui-form layui-card" lay-filter="sendMessageForm">
            <div class="layui-card-body">
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.noticeTitle">标题</label>
                    <div class="layui-input-block">
                        <input name="noticeTitle" data-placeholder="member.petNoticeTitle" lay-verify="required" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.noticeContent">内容</label>
                    <div class="layui-input-block">
                        <input name="noticeContent" data-placeholder="member.petNoticeContent" lay-verify="required" class="layui-input"/>
                    </div>
                </div>

                <div class="hr-line-dashed"></div>
                <div class="layui-form-item text-center">
                    <button class="layui-btn" type="button" lay-submit lay-filter="sendMessageSubmit" data-locale="submit">提交</button>
                    <button class="layui-btn layui-btn-danger" type="button" data-close="" id="sendMessageCancel" data-locale="cancel">取消
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!--银行卡信息-->
    <div id="bankCardInfoId" style="display: none">
        <form class="layui-form layui-card" lay-filter="bankCardInfoForm">
            <div class="layui-card-body">
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.accountName">开户名</label>
                    <div class="layui-input-block">
                        <input name="accountName" data-placeholder="member.petAccountName" lay-verify="required" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.bankName">银行名称</label>
                    <div class="layui-input-block">
                        <input name="bankName" data-placeholder="member.petBankName" lay-verify="required" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.bankNumber">银行编号</label>
                    <div class="layui-input-block">
                        <input name="bankNumber" data-placeholder="member.petBankNumber" lay-verify="required" class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.cardNum">银行卡号</label>
                    <div class="layui-input-block">
                        <input name="cardNum" type="number" data-placeholder="member.petCardNum" lay-verify="required"
                               class="layui-input"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label label-required label-required-next" data-locale="member.bankCountry">银行所在国家</label>
                    <div class="layui-input-block">
                        <input name="bankCountry" data-placeholder="member.petBankCountry" lay-verify="required" class="layui-input"/>
                    </div>
                </div>

                <div class="hr-line-dashed"></div>
                <div class="layui-form-item text-center">
                    <button class="layui-btn" type="button" lay-submit lay-filter="bankCardInfoSubmit" data-locale="submit">提交</button>
                    <button class="layui-btn layui-btn-danger" type="button" id="bankCardInfoCancel" data-locale="cancel">取消
                    </button>
                </div>
            </div>
        </form>
    </div>

</div>

<!--账号-->
<script type="text/html" id="userAccount">
    <div>
        <div>{{$t('member.phoneNumber')}}：{{=d.phoneNumber}}</div>
        <div>{{$t('member.userName')}}：{{=d.userAccount}}</div>
        <div class="layui-btn layui-btn-xs layui-btn-normal">{{=d.memberStatus === 1 ? $t('member.status1') : $t('member.status2')}}</div>
    </div>
</script>

<!--会员等级-->
<script type="text/html" id="memberLevelId">
    <div>
        <div>{{$.findName(memberLevelOptions, d.memberLevelId)}}</div>
        <div style="color: red">0% - 0%</div>
    </div>
</script>

<!--账户余额-->
<!--缺少利息宝金额-->
<script type="text/html" id="balance">
    <div>
        <div>{{$t('member.balance')}}:{{$.financial(d.balance)}}</div>
        <div>{{$t('member.freezeBalance')}}:{{$.financial(d.freezeBalance)}}</div>
<!--        <div>利息宝金额:</div>-->
    </div>
</script>

<!--邀请码-->
<script type="text/html" id="inviteCode">
    <div>
        <div class="layui-btn layui-btn-sm" lay-event="upInviteCode">{{$t('modify')}}</div>
        <span>{{=d.inviteCode}}</span>
    </div>
</script>

<!--注册信息-->
<script type="text/html" id="register">
    <div>
        <p>{{ layui.util.toDateString(d.registrationTime, 'yyyy-MM-dd')}}</p>
        <p>{{ d.registerCountry}}{{ d.registerIp ? '(' + d.registerIp +')' : ''}}</p>
    </div>
</script>


<style>
    .member-btn-container .layui-btn {
        margin-right: 4px;
    }
</style>
<!--操作-->
<script type="text/html" id="operation">
    <div class="layui-btn-container member-btn-container">
        <a class="layui-btn layui-btn-xs" lay-event="deduction">{{ $t('member.deduction') }}</a>
        <a class="layui-btn layui-btn-xs" lay-event="dispatch">{{ $t('member.dispatch') }}</a>
        <a class="layui-btn layui-btn-xs" lay-event="bankCardInfo">{{ $t('member.bankCardInfo') }}</a>
        <a class="layui-btn layui-btn-xs" lay-event="edit">{{ $t('edit') }}</a>
        <a class="layui-btn layui-btn-xs" lay-event="toggleState">{{ d.status === 1 ? $t('enable') : $t('disable') }}</a>
        <a class="layui-btn layui-btn-xs" lay-event="drawalStatus">{{=d.drawalStatus === 1 ? $t('member.normalWithdrawal') : $t('member.noWithdrawal')}}</a>
        <a class="layui-btn layui-btn-xs" lay-event="sendMessage">{{ $t('member.sendMessage') }}</a>
        <a class="layui-btn layui-btn-xs" lay-event="addressInfo">{{ $t('member.addressInfo') }}</a>
        <a class="layui-btn layui-btn-xs" lay-event="viewPassword">{{ $t('member.viewPassword') }}</a>
        <a class="layui-btn layui-btn-xs" lay-event="viewTeam" style="margin-bottom: 0">{{ $t('member.viewTeam') }}</a>
        <a class="layui-btn layui-btn-xs" lay-event="accountChange" style="margin-bottom: 0">{{ $t('member.accountChange') }}</a>
        <a class="layui-btn layui-btn-xs" lay-event="realPerson" style="margin-bottom: 0">{{=d.memberStatus === 1 ? $t('member.setAsDummy') : $t('member.setAsRealPerson')}}</a>
        <a class="layui-btn layui-btn-xs" lay-event="delete" style="margin-bottom: 0">{{ $t('delete') }}</a>
    </div>
</script>

<script>


    layui.use(['table', 'form', 'laydate', 'laytpl'], function () {
        var table = layui.table, $ = layui.$, form = layui.form;
        var laydate = layui.laydate;
        var laytpl = layui.laytpl;

        // 表格当前选择项
        var tableCurrentItem = {};
        var currentAddressInfoItem = {};
        var currentBankCardInfoItem = {};

        // 扣款弹窗Index
        var deductionIndex;
        // 修改邀请码弹窗Index
        var upInviteCodeIndex;
        var editIndex;
        var addressInfoIndex;
        var bankCardInfoIndex;
        var sendMessageIndex;

        var i18n = new I18n();
        var $t = i18n.$t;
        window.i18n = i18n;
        window.$t = $t;

        var memberLevelOptions = [
            {name: '普通会员', value: 1},
            {name: '黄金会员', value: 2},
            {name: '铂金会员', value: 3},
            {name: '钻石会员', value: 4},
            {name: '至尊会员', value: 5},
        ];
        memberLevelOptions.forEach(function (item) {
            var option = document.createElement('option');
            option.setAttribute('value', item.value);
            option.innerText = item.name;
            $('#memberLevelSelect').append(option);
        });

        // 渲染日期
        laydate.render({
            elem: '#registrationTime',
            range: true //或 range: '~' 来自定义分割字符
        });

        // 表单校验
        form.verify({
            limitAmount: function (value, item) {
                // 设定金额不能为空
                if (!value) {
                    return $t('member.verify.text1')
                }
                var v = Number(value);
                // 设定金额不能小于100
                if (v < 100) {
                    return $t('member.verify.text2')
                }
            }
        });

        var where = {};

        // 渲染表格
        var memberListTableId = 'memberListTable';
        table.render(Object.assign({}, $.tableRenderConfing, {
            elem: '#member-list',
            url: 'http://localhost:8080/action/member/list', //数据接口
            // url: '/action/member/list', //数据接口
            cellMinWidth: 100, //全局定义常规单元格的最小宽度
            method: 'post',
            contentType: 'application/json',
            page: true, //开启分页
            where: where,
            lineStyle: 'height: 100px; padding-bottom: 0;',
            // ID	账号	会员等级	账户余额	提现	冻结金额	上级用户	邀请码	注册信息	操作
            cols: [[ //表头
                // {type: 'checkbox', fixed: 'left'}
                {field: 'id', title: 'ID', width: 60, sort: true}
                , {field: 'userAccount', title: $t('member.userAccount'), templet: '#userAccount', width: 180}
                , {
                    field: 'memberLevelId', title: $t('member.memberLevelId'), templet: function (d) {
                        var name = $.findName(memberLevelOptions, d.memberLevelId);
                        var min = d.matchMin || 0;
                        var max = d.matchMax || 0;
                        return "<div><div>" + name + "</div><div style='color: red'>" + min + "% - " + max + "%</div></div>"
                    }, sort: true, width: 120
                }
                , {field: 'balance', title: $t('member.balance'), templet: '#balance', sort: true, minWidth: 180}
                , {
                    field: 'depositNum', title: $t('member.depositNum'), templet: function (d) {
                        return $.financial(d.depositNum)
                    }, sort: true, minWidth: 120
                }
                , {
                    field: 'freezeBalance', title: $t('member.freezeBalance'), templet: function (d) {
                        return $.financial(d.freezeBalance)
                    }, sort: true, minWidth: 120
                }
                , {field: 'parentUserName', title: $t('member.parentUserName'), sort: true, minWidth: 120}
                , {
                    field: 'inviteCode',
                    title: $t('member.inviteCode'),
                    templet: '#inviteCode',
                    sort: true,
                    minWidth: 160
                }
                , { field: 'registerId', title: $t('member.registerInfo'), templet: '#register', sort: true, minWidth: 160 }
                , {
                    field: 'operation', title: $t('member.operation'), templet: '#operation', fixed: 'right', width: 300
                }
            ]],
            id: memberListTableId, // 容器唯一ID
        }));

        var actions = {
            apiUrl: {
                update: '/action/member/update/',
                delete: '/action/member/delete/',
                create: '/action/member/create',
            },
            // 刷新表格数据
            onReloadData: function () {
                table.reloadData(memberListTableId, {where: Object.assign({}, where, onGetSearchParams())});
            },
            onUpdateItem: function (id, fields, cb) {
                $.request({
                    url: actions.apiUrl.update + id,
                    type: 'post',
                    contentType: 'application/json',
                    data: fields,
                    showLoading: true,
                    success: function () {
                        actions.onReloadData();
                        layer.msg($t('operationSucceeded'), {icon: 1});
                        cb && cb();
                    }
                })
            },
            onDelete: function (id, cb) {
                $.request({
                    url: actions.apiUrl.delete + id,
                    type: 'get',
                    showLoading: true,
                    success: function () {
                        actions.onReloadData();
                        layer.msg($t('operationSucceeded'), {icon: 1});
                        cb && cb();
                    },
                });
            },
        };

        // 获取搜索参数
        var onGetSearchParams = function () {
            var searchData = form.val('searchForm');
            var times = $.getRangeTime(searchData.time);
            // searchData.status = Number(searchData.status) || null;
            searchData.memberStatus = Number(searchData.memberStatus) || null;
            searchData.selectBeginTime = times[0];
            searchData.selectEndTime = times[1];
            delete searchData.time;
            return searchData;
        }

        //单元格工具事件
        table.on('tool(member-list)', function (obj) { // 注：test 是 table 原始标签的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）

            // 设置当前选择项
            tableCurrentItem = Object.assign({}, data);

            // 修改邀请码
            if (layEvent === 'upInviteCode') {
                upInviteCodeIndex = layer.open({
                    type: 1,
                    // value: data.inviteCode,
                    title: $t('member.modifyInvitationCode'),
                    area: '800px',
                    content: $('#upInviteCodeId'),
                    success: function () {
                        $('#newInviteCode').val(data.inviteCode);
                        $('#upInviteCodeId').show();
                    },
                    cancel: function () {
                        $('#upInviteCodeId').hide();
                    }
                });
                // function(value, index, elem){
                //        if (!value) {
                //            layer.msg('请输入邀请码');
                //            // alert('请输入邀请码');
                //            return;
                //        }
                //        layer.close(index);
                //    }
            } else if (layEvent === 'deduction') { // 扣款
                deductionIndex = layer.open({
                    type: 1,
                    title: $t('member.deduction'),
                    area: '800px',
                    content: $('#deductionId'), //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
                    success: function () {
                        $('#deductionId').show();
                    },
                    cancel: function () {
                        $('#deductionId').hide();
                    }
                });
            } else if (layEvent === 'dispatch') { // 派单
                // layer.open({
                //     type: 2,
                //     title: '派单',
                //     area: ['800px', '500px'],
                //     content: '/dispatchForm.html?id=' + data.id,
                //     // content: 'http://localhost:63342/chengguangshop/fast/static/dispatchForm.html?id=' + data.id,
                //     end: function () {
                //         actions.onReloadData();
                //     }
                // });
                window.parent.layui.tab.tabAdd({
                    id: 'dispatch_' + data.id,
                    title: $t('member.dispatch'),
                    icon: 'fa-file',
                    url: '/dispatch.html?id=' + data.id,
                })
            } else if (layEvent === 'edit') { // 编辑菜单
                editIndex = layer.open({
                    type: 1,
                    title: $t('edit'),
                    area: '800px',
                    content: $('#editId'),
                    success: function () {
                        form.val('editForm', data);
                        // $('#editId input[name=balance]').attr('disabled', true)
                        // $('#editId input[name=freezeBalance]').attr('disabled', true)
                        $('#editId').show();
                        // form.render();
                    },
                    cancel: function () {
                        $('#editId').hide();
                    }
                });
            } else if (layEvent === 'bankCardInfo') { // 银行卡信息
                $.request({
                    url: '/action/bank/select/' + tableCurrentItem.id,
                    type: 'get',
                    success: function (result) {
                        currentBankCardInfoItem = Object.assign({
                            accountName: '',
                            bankCountry: '',
                            bankName: '',
                            bankNumber: '',
                            cardNum: '',
                            id: '',
                        }, result.data);

                        form.val('bankCardInfoForm', currentBankCardInfoItem);
                        bankCardInfoIndex = layer.open({
                            type: 1,
                            title: $t('member.bankCardInfo'),
                            area: '800px',
                            content: $('#bankCardInfoId'),
                            success: function () {
                                $('#bankCardInfoId').show();
                            },
                            cancel: function () {
                                $('#bankCardInfoId').hide();
                            }
                        });
                    },
                })

                // layer.msg('没有数据', {icon: 2});
            } else if (layEvent === 'toggleState') { //状态切换
                // 帐号状态（0正常 1停用）
                actions.onUpdateItem(tableCurrentItem.id, {status: data.status === 0 ? 1 : 0})
            } else if (layEvent === 'drawalStatus') { //提现状态切换
                // 帐号状态（0正常 1停用）
                actions.onUpdateItem(tableCurrentItem.id, {drawalStatus: data.drawalStatus === 0 ? 1 : 0})
            } else if (layEvent === 'addressInfo') { // 地址信息
                $.request({
                    url: '/action/address/select/' + tableCurrentItem.id,
                    type: 'get',
                    success: function (result) {
                        currentAddressInfoItem = Object.assign({
                            address: '',
                            name: '',
                            tel: '',
                            id: '',
                        }, result.data);
                        form.val('addressInfoForm', currentAddressInfoItem);
                        addressInfoIndex = layer.open({
                            type: 1,
                            title: $t('member.addressInfo'),
                            area: '800px',
                            content: $('#addressInfoId'),
                            success: function () {
                                $('#addressInfoId').show();
                            },
                            cancel: function () {
                                $('#addressInfoId').hide();
                            }
                        });
                    },
                })

            } else if (layEvent === 'viewPassword') {
                var text = data.password;
                layer.open({
                    title: $t('member.viewPassword'),
                    type: 1,
                    content: '<h6 style="padding: 20px 0; font-size: 18px; width: 400px; text-align: center">' + text + '</h6>',
                })
                console.log('viewPassword', data.password, data);
            } else if (layEvent === 'viewTeam') { // 查看团队
                window.parent.layui.tab.tabAdd({
                    id: new Date().getTime(),
                    title: $t('member.viewTeam'),
                    icon: 'fa-file',
                    url: '/viewTeam.html?id=' + data.id
                })
                // window.location.href = './viewTeam.html';
            } else if (layEvent === 'accountChange') { // 帐变
                window.parent.layui.tab.tabAdd({
                    id: 'caiwu_' + data.id,
                    title: $t('member.accountChange'),
                    icon: 'fa-file',
                    url: '/caiwu.html?id=' + data.id,
                })
            } else if (layEvent === 'realPerson') { // 设为真人
                // 状态:1.真人2.假人
                actions.onUpdateItem(tableCurrentItem.id, {memberStatus: data.memberStatus === 1 ? 2 : 1})
            } else if (layEvent === 'sendMessage') { // 发送消息
                sendMessageIndex = layer.open({
                    type: 1,
                    title: $t('member.sendMessage'),
                    area: '800px',
                    content: $('#sendMessageId'),
                    success: function () {
                        $('#sendMessageId').show();
                    },
                    cancel: function () {
                        $('#sendMessageId').hide();
                    }
                });

            } else if (layEvent === 'delete') { // 删除
                layer.confirm($t('deleteConfirmation'), {title: $t('operationConfirmation')}, function (index) {
                    actions.onDelete(data.id, function () {
                        layer.close(index);
                    });
                });
            }

        });

        // 搜索
        form.on('submit(search)', function (data) {
            console.log(data.field);
            actions.onReloadData();
            return false;
        });

        // 邀请码-提交
        form.on('submit(upInviteCodeSubmit)', function (formData) {
            actions.onUpdateItem(tableCurrentItem.id, formData.field, function () {
                layer.close(upInviteCodeIndex);
                $('#upInviteCodeId').hide();
            });
            return false;
        });
        // 邀请码-取消
        $('#dupInviteCodeCancel').click(function () {
            layer.close(upInviteCodeIndex);
        });

        // 扣款-提交
        form.on('submit(deductionSubmit)', function (data) {
            var fd = Object.assign({}, data.field, {
                memberId: tableCurrentItem.id,
            });
            fd.operaMount = Number(fd.operaMount);
            $.request({
                url: '/action/deposit/deposit',
                type: 'post',
                data: fd,
                showLoading: true,
                success: function () {
                    onDeductionCancel();
                    layer.msg($t('operationSucceeded'), {icon: 1});
                    actions.onReloadData();
                }
            });
            return false;
        });
        // 扣款-取消
        var onDeductionCancel = function () {
            form.val('deductionForm', {
                operaMount: 0,
                remank: "",
            })
            layer.close(deductionIndex);
            $('#deductionId').hide();
        }
        $('#deductionCancel').click(onDeductionCancel);


        // 编辑-提交
        form.on('submit(editSubmit)', function (data) {
            // layer.msg(JSON.stringify(data.field));
            actions.onUpdateItem(tableCurrentItem.id, data.field, function () {
                layer.close(editIndex);
                $('#editId').hide();
            })
            return false;
        });
        // 编辑-取消
        $('#editCancel').click(function () {
            layer.close(editIndex);
        });

        // 地址信息-提交
        form.on('submit(addressInfoSubmit)', function (data) {
            $.request({
                url: '/action/address/save',
                type: 'post',
                data: Object.assign({}, currentAddressInfoItem, data.field, {memberId: tableCurrentItem.id}),
                success: function () {
                    onAddressInfoCancel();
                    actions.onReloadData();
                    layer.msg($t('operationSucceeded'), {icon: 1});
                }
            })
            return false;
        });
        // 地址信息-取消
        var onAddressInfoCancel = function () {
            form.val('addressInfoForm', {
                address: '',
                name: '',
                tel: '',
                id: '',
            })
            layer.close(addressInfoIndex);
        };
        $('#addressInfoCancel').click(onAddressInfoCancel);

        // 银行卡-提交
        form.on('submit(bankCardInfoSubmit)', function (data) {
            $.request({
                url: '/action/bank/save',
                type: 'post',
                data: Object.assign({}, currentBankCardInfoItem, data.field, {memberId: tableCurrentItem.id}),
                success: function () {
                    layer.close(bankCardInfoIndex);
                    actions.onReloadData();
                    layer.msg($t('operationSucceeded'), {icon: 1});
                }
            })
            return false;
        });
        // 银行卡-取消
        $('#bankCardInfoCancel').click(function () {
            form.val('bankCardInfoForm', {
                accountName: '',
                bankCountry: '',
                bankName: '',
                bankNumber: '',
                cardNum: '',
            });
            layer.close(bankCardInfoIndex);
        });

        // 创建会员-提交
        form.on('submit(createSubmit)', function (data) {
            $.request({
                url: actions.apiUrl.create,
                type: 'post',
                contentType: 'application/json',
                data: data.field,
                showLoading: true,
                success: function () {
                    actions.onReloadData();
                    layer.msg($t('operationSucceeded'), {icon: 1});
                    onCreateCancel();
                },
            });
        });
        // 创建会员-取消
        var onCreateCancel = function () {
            form.val('createForm', {
                userAccount: '',
                phoneNumber: '',
                password: '',
                parentUserId: '',
            })
            layer.close(createIndex);
        }
        $('#createCancel').click(onCreateCancel);

        var createIndex;
        $('#createBtn').click(function () {
            createIndex = layer.open({
                type: 1,
                title: $t('member.createMember'),
                area: '800px',
                content: $('#createId'),
                success: function () {
                    $('#createId').show();
                },
                cancel: function () {
                    $('#createId').hide();
                }
            });
        })


        // 发送消息-提交
        form.on('submit(sendMessageSubmit)', function (data) {
            var fd = Object.assign({
                noticeClasses: 2, // 个人通知
                noticeType: 1, // 公告类型（1通知 2公告）
            }, data.field);
            $.request({
                url: '/action/notice/create',
                type: 'post',
                data: fd,
                success: function () {
                    layer.close(sendMessageIndex);
                    onSendMessageCancel();
                    layer.msg($t('operationSucceeded'), {icon: 1});
                },
            })
        });
        var onSendMessageCancel = function () {
            layer.close(sendMessageIndex);
            $('#sendMessageId').hide();
            form.val('sendMessageForm', {
                noticeTitle: '',
                noticeContent: '',
            })
        }
        $('#sendMessageCancel').click(onSendMessageCancel)

    });
</script>

</body>

</html>
